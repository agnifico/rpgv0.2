import"../chunks/DsnmJJEf.js";import"../chunks/SHE-Eawp.js";import{o as Te}from"../chunks/CISUGYC8.js";import{i as fe,ad as Fe,O as V,ae as $,af as He,ag as Se,a5 as d,ac as g,a6 as p,ah as Re,g as e,ai as Be,a7 as n,a8 as r,b as l,e as w,a9 as s,z as L,ab as le}from"../chunks/B7Bxd_9_.js";import{e as c,s as F}from"../chunks/sCU6v1re.js";import{i as A}from"../chunks/CzpE0DJu.js";import{e as X,i as Y}from"../chunks/gF93KO7x.js";import{h as Ce}from"../chunks/BUQRe8YB.js";import{s as P}from"../chunks/GfmKZXy5.js";import{t as Me,g as i,s as re,V as se,d as oe,b as Oe,c as Ve}from"../chunks/D4nx_CMT.js";import{s as We,b as ze,a as Ge}from"../chunks/Dacigmw8.js";import{i as Ue}from"../chunks/ujNSNToK.js";function qe(D,H,ne,j){var ie=D.__style;if(fe||ie!==H){var t=Me(H);(!fe||t!==D.getAttribute("style"))&&(t==null?D.removeAttribute("style"):D.style.cssText=t),D.__style=H}return j}var Ke=d('<div class="player-icon svelte-1ly0pwl">P</div>'),Le=d("<img/>"),Xe=d('<img class="tile-image svelte-1ly0pwl"/> <!> <!>',1),Ye=d("<div><!></div>"),je=d('<div class="map-row svelte-1ly0pwl"></div>'),Je=d('<pre class="tooltip-content svelte-1ly0pwl"> </pre>'),Ne=d('<img class="encounter-image svelte-1ly0pwl"/> <h3> </h3> <div class="stats-and-hide-buttons svelte-1ly0pwl"><div class="stats-tooltip-container svelte-1ly0pwl"><button class="stats-button svelte-1ly0pwl" disabled>Stats</button> <!></div> <button class="hide-button svelte-1ly0pwl">Hide</button></div>',1),Qe=d('<p class="svelte-1ly0pwl"> </p>'),Ze=d("<p> </p> <p> </p>",1),et=d("<p> </p>"),tt=d('<div class="fullscreen-image-details svelte-1ly0pwl"><h3> </h3> <!> <!></div>'),at=d('<div class="fullscreen-overlay svelte-1ly0pwl"><div class="fullscreen-image-container svelte-1ly0pwl"><button class="close-button svelte-1ly0pwl">&times;</button> <img alt="Fullscreen" class="fullscreen-image svelte-1ly0pwl"/> <!></div></div>'),lt=d('<main tabindex="0" class="svelte-1ly0pwl"><div class="game-container svelte-1ly0pwl"><div class="map-screen svelte-1ly0pwl"></div> <div><!></div> <div class="text-box svelte-1ly0pwl"></div> <div class="buttons-tray svelte-1ly0pwl"><div class="dpad-container svelte-1ly0pwl"><div class="dpad-spacer svelte-1ly0pwl"></div> <button class="dpad-button up svelte-1ly0pwl">&#9650;</button> <div class="dpad-spacer svelte-1ly0pwl"></div> <button class="dpad-button left svelte-1ly0pwl">&#9664;</button> <button class="dpad-button down svelte-1ly0pwl">&#9660;</button> <button class="dpad-button right svelte-1ly0pwl">&#9654;</button></div> <div class="action-buttons svelte-1ly0pwl"><button class="action-button svelte-1ly0pwl">A</button> <button class="action-button svelte-1ly0pwl">B</button> <button class="action-button svelte-1ly0pwl">C</button> <button class="action-button svelte-1ly0pwl">D</button></div></div></div> <!></main>');function bt(D,H){Fe(H,!1);const[ne,j]=Ge();let t=V(We(i,"$gameStore",ne)),W=V(),J=V(!0);i.subscribe(a=>{$(t,a)});function ge(a,v){return e(t).map.find(o=>o.x===a&&o.y===v)}function we(a,v){return e(t).entities.filter(o=>o.x===a&&o.y===v)}function he(a){if(e(t).showFullscreenImage&&a.key==="Escape"){i.closeFullscreenImage();return}switch(a.key){case"ArrowUp":case"w":i.movePlayer(0,-1);break;case"ArrowDown":case"s":i.movePlayer(0,1);break;case"ArrowLeft":case"a":i.movePlayer(-1,0);break;case"ArrowRight":case"d":i.movePlayer(1,0);break}}let N=V(!1),z=V("");function ke(a){$(N,!0),a.type==="enemy"?$(z,`HP: ${a.hp}
Attack: ${a.attack}`):a.type==="npc"&&$(z,`Dialogue: ${a.dialogue[0]}`)}function Ee(){$(N,!1),$(z,"")}Te(()=>{e(W)&&e(W).focus()}),He(()=>e(t),()=>{e(t).currentEncounter&&$(J,!0)}),Se(),Ue();var R=lt();Ce(a=>{Be.title="Map - RPG"});var Q=n(R),G=n(Q);X(G,5,()=>(w(se),l(()=>Array(se))),Y,(a,v,o)=>{var m=je();X(m,5,()=>(w(oe),l(()=>Array(oe))),Y,(S,B,T,u)=>{const _=L(()=>(e(t),l(()=>e(t).player.viewX+T))),b=L(()=>(e(t),l(()=>e(t).player.viewY+o))),y=L(()=>(w(e(_)),w(e(b)),l(()=>ge(e(_),e(b))))),x=L(()=>(w(e(_)),w(e(b)),l(()=>we(e(_),e(b)))));var h=Ye(),C=n(h);{var te=f=>{var E=Xe(),I=le(E),q=r(I,2);{var K=M=>{var k=Ke();p(M,k)};A(q,M=>{e(t),w(e(_)),w(e(b)),l(()=>e(t).player.x===e(_)&&e(t).player.y===e(b))&&M(K)})}var ae=r(q,2);X(ae,1,()=>e(x),Y,(M,k)=>{var O=Le();g(()=>{P(O,"src",(e(k),l(()=>e(k).thumbnailImage))),P(O,"alt",(e(k),l(()=>e(k).name))),re(O,1,`entity-icon ${e(k),l(()=>e(k).type)??""}`,"svelte-1ly0pwl"),P(O,"title",(e(k),l(()=>e(k).name)))}),p(M,O)}),g(()=>{P(I,"src",(w(e(y)),l(()=>e(y).tileImage))),P(I,"alt",(w(e(y)),l(()=>e(y).tileType)))}),p(f,E)};A(C,f=>{e(y)&&f(te)})}s(h),g(()=>re(h,1,`map-tile ${w(e(y)),l(()=>e(y)?.tileType)??""}`,"svelte-1ly0pwl")),p(S,h)}),s(m),p(a,m)}),s(G);var U=r(G,2);let ce;var Ie=n(U);{var $e=a=>{var v=Ne(),o=le(v),m=r(o,2),S=n(m,!0);s(m);var B=r(m,2),T=n(B),u=n(T),_=r(u,2);{var b=x=>{var h=Je(),C=n(h,!0);s(h),g(()=>F(C,e(z))),p(x,h)};A(_,x=>{e(N)&&x(b)})}s(T);var y=r(T,2);s(B),g(()=>{P(o,"src",(e(t),l(()=>e(t).currentEncounter.image))),P(o,"alt",(e(t),l(()=>e(t).currentEncounter.name))),F(S,(e(t),l(()=>e(t).currentEncounter.name)))}),c("click",o,()=>i.openFullscreenImage(e(t).currentEncounter.image,{name:e(t).currentEncounter.name,type:e(t).currentEncounter.type,hp:e(t).currentEncounter.hp,attack:e(t).currentEncounter.attack,dialogue:e(t).currentEncounter.dialogue})),c("mouseenter",u,()=>ke(e(t).currentEncounter)),c("mouseleave",u,Ee),c("click",y,()=>$(J,!1)),p(a,v)};A(Ie,a=>{e(t),l(()=>e(t).currentEncounter)&&a($e)})}s(U);var Z=r(U,2);X(Z,5,()=>(e(t),l(()=>e(t).currentMessage)),Y,(a,v)=>{var o=Qe(),m=n(o,!0);s(o),g(()=>F(m,e(v))),p(a,o)}),s(Z);var ve=r(Z,2),ee=n(ve),ue=r(n(ee),2),pe=r(ue,4),de=r(pe,2),xe=r(de,2);s(ee);var me=r(ee,2),_e=n(me),be=r(_e,2),ye=r(be,2),Ae=r(ye,2);s(me),s(ve),s(Q);var Pe=r(Q,2);{var De=a=>{var v=at(),o=n(v),m=n(o),S=r(m,2),B=r(S,2);{var T=u=>{var _=tt(),b=n(_),y=n(b,!0);s(b);var x=r(b,2);{var h=f=>{var E=Ze(),I=le(E),q=n(I);s(I);var K=r(I,2),ae=n(K);s(K),g(()=>{F(q,`HP: ${e(t),l(()=>e(t).fullscreenImageDetails.hp)??""}`),F(ae,`Attack: ${e(t),l(()=>e(t).fullscreenImageDetails.attack)??""}`)}),p(f,E)};A(x,f=>{e(t),l(()=>e(t).fullscreenImageDetails.type==="enemy")&&f(h)})}var C=r(x,2);{var te=f=>{var E=et(),I=n(E);s(E),g(()=>F(I,`Dialogue: ${e(t),l(()=>e(t).fullscreenImageDetails.dialogue[0])??""}`)),p(f,E)};A(C,f=>{e(t),l(()=>e(t).fullscreenImageDetails.type==="npc")&&f(te)})}s(_),g(()=>F(y,(e(t),l(()=>e(t).fullscreenImageDetails.name)))),p(u,_)};A(B,u=>{e(t),l(()=>e(t).fullscreenImageDetails)&&u(T)})}s(o),s(v),g(()=>P(S,"src",(e(t),l(()=>e(t).fullscreenImageUrl)))),c("click",m,function(...u){i.closeFullscreenImage?.apply(this,u)}),c("click",o,Oe(function(u){Ve.call(this,H,u)})),c("click",v,function(...u){i.closeFullscreenImage?.apply(this,u)}),p(a,v)};A(Pe,a=>{e(t),l(()=>e(t).showFullscreenImage)&&a(De)})}s(R),ze(R,a=>$(W,a),()=>e(W)),g(a=>{qe(G,`--viewport-width: ${oe}; --viewport-height: ${se}; --tile-size: 32px;`),ce=re(U,1,"encounter-box svelte-1ly0pwl",null,ce,a)},[()=>({hidden:!e(t).currentEncounter||!e(J)})]),c("click",ue,()=>i.movePlayer(0,-1)),c("click",pe,()=>i.movePlayer(-1,0)),c("click",de,()=>i.movePlayer(0,1)),c("click",xe,()=>i.movePlayer(1,0)),c("click",_e,()=>i.handleAction("A")),c("click",be,()=>i.handleAction("B")),c("click",ye,()=>i.handleAction("C")),c("click",Ae,()=>i.handleAction("D")),c("keydown",R,he),p(D,R),Re(),j()}export{bt as component};
