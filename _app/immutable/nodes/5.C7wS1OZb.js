import"../chunks/DsnmJJEf.js";import"../chunks/DKbr7FTX.js";import{a as Ue,o as Ze}from"../chunks/CyCOytMA.js";import{ak as Le,a5 as F,aw as x,ay as Oe,az as Ge,al as d,aA as Je,au as u,am as k,an as Ke,P as e,aB as Qe,aC as Ye,ao as s,u as r,ap as a,ar as j,Q as T,W as N,as as A,aq as i,at as R}from"../chunks/MrBcGwl5.js";import{i as $}from"../chunks/CgIxXxhB.js";import{e as ee,i as te}from"../chunks/BrZ-0oqd.js";import{s as ae,a as y}from"../chunks/DEeg4q6a.js";import{s as je}from"../chunks/CtQ7uExx.js";import{b as _e}from"../chunks/BH8cJuky.js";import{s as Ne,b as et}from"../chunks/DEdAOqeD.js";import{i as tt}from"../chunks/jgPfo2ed.js";import{s as at,a as rt}from"../chunks/TzUclg7W.js";import{g as l,V as ue,b as pe}from"../chunks/DHWkHW8p.js";var st=d("<p>Loading map...</p>"),it=d('<div class="player-icon svelte-1qpiukk"><img alt="Player" class="player-image svelte-1qpiukk"/></div>'),ot=d("<img/>"),nt=d('<img class="tile-image svelte-1qpiukk"/> <!> <!>',1),lt=d("<div><!></div>"),vt=d('<div class="map-row svelte-1qpiukk"></div>'),ct=d('<pre class="tooltip-content svelte-1qpiukk"> </pre>'),ut=d('<pre class="tooltip-content svelte-1qpiukk"> </pre>'),pt=d('<div class="npc-avatar svelte-1qpiukk"><img class="encounter-image svelte-1qpiukk"/> <h3 class="svelte-1qpiukk"> </h3></div> <div class="rank-indicators svelte-1qpiukk"><div class="rank-bubble sword svelte-1qpiukk"><img alt="Sword Rank" class="svelte-1qpiukk"/> <span> </span></div> <div class="rank-bubble heart svelte-1qpiukk"><img alt="Heart Rank" class="svelte-1qpiukk"/> <span> </span></div></div> <div class="actions-container svelte-1qpiukk"><div class="tooltip-wrapper svelte-1qpiukk"><button class="icon-button svelte-1qpiukk"><img alt="Stats" class="button-icon svelte-1qpiukk"/></button> <!></div> <div class="tooltip-wrapper svelte-1qpiukk"><button class="icon-button svelte-1qpiukk"><img alt="Details" class="button-icon svelte-1qpiukk"/></button> <!></div> <button class="hide-button svelte-1qpiukk">x</button></div>',1),kt=d("<p> </p>"),dt=d('<div class="buttons-tray svelte-1qpiukk"><div class="dpad-container svelte-1qpiukk"><button class="dpad-button up svelte-1qpiukk">&#9650;</button> <button class="dpad-button hide-controls-button svelte-1qpiukk">&#10005;</button> <button class="dpad-button left svelte-1qpiukk">&#9664;</button> <button class="dpad-button down svelte-1qpiukk">&#9660;</button> <button class="dpad-button right svelte-1qpiukk">&#9654;</button></div> <div class="action-buttons svelte-1qpiukk"><button class="button-2 action-button svelte-1qpiukk">Z</button> <button class="button-2 action-button svelte-1qpiukk">X</button> <button class="button-2 action-button svelte-1qpiukk">C</button> <button class="button-2 action-button svelte-1qpiukk">V</button></div></div>'),mt=d('<button class="floating-restore-button svelte-1qpiukk">Show Controls</button>'),_t=d("<p> </p> <p> </p>",1),bt=d("<p> </p>"),gt=d('<div class="fullscreen-image-details svelte-1qpiukk"><h3> </h3> <!> <!></div>'),ft=d('<div class="fullscreen-overlay svelte-1qpiukk"><div class="fullscreen-image-container svelte-1qpiukk"><button class="close-button svelte-1qpiukk">&times;</button> <img alt="Fullscreen" class="fullscreen-image svelte-1qpiukk"/> <!></div></div>'),ht=d('<div class="game-container svelte-1qpiukk"><div class="map-screen svelte-1qpiukk"></div> <div><!></div> <div class="second-row svelte-1qpiukk"><div class="text-box svelte-1qpiukk"></div> <div class="small-encounter-screen svelte-1qpiukk"><img alt="" class="svelte-1qpiukk"/></div></div> <!></div> <!>',1),qt=d('<main tabindex="0" class="svelte-1qpiukk"><!></main>');function Vt(be,ke){Le(ke,!1);const[ge,fe]=rt(),re=()=>at(l,"$gameStore",ge),he=".";let t=F(re()),J=F(),se=F(!0),B=F();l.subscribe(o=>{x(t,o)}),Ue(()=>{e(B)&&Ye(B,e(B).scrollTop=e(B).scrollHeight)});function qe(o,E){return e(t).map.find(S=>S.x===o&&S.y===E)}function ye(o,E){return e(t).entities.filter(S=>S.x===o&&S.y===E)}function we(o){if(e(t).showFullscreenImage&&o.key==="Escape"){l.closeFullscreenImage();return}switch(o.key){case"ArrowUp":case"w":l.movePlayer(0,-1);break;case"ArrowDown":case"s":l.movePlayer(0,1);break;case"ArrowLeft":case"a":l.movePlayer(-1,0);break;case"ArrowRight":case"d":l.movePlayer(1,0);break;case"z":l.handleAction("Z");break;case"x":l.handleAction("X");break;case"c":l.handleAction("C");break;case"v":l.handleAction("V");break}}let ie=F(!1),oe=F(!1),ne=F("");function xe(o){x(ie,!0),x(ne,`HP: ${o.hp}
Attack: ${o.attack}`)}function Ie(){x(ie,!1),x(ne,"")}function Ae(){x(oe,!0)}function Ee(){x(oe,!1)}Ze(()=>{e(J)&&e(J).focus()});let le=F(!0);function De(o){return o.startsWith("[World]:")?"world":e(t).entities.some(E=>o.startsWith(`[${E.name}]:`)&&E.type==="npc")?"npc":o.includes("defeated")?"enemy":"player"}Oe(()=>e(t),()=>{e(t).currentEncounter&&x(se,!0)}),Ge(),tt();var L=qt();Je(o=>{Qe.title="Dawn's Journey : Map"});var Te=s(L);{var $e=o=>{var E=st();k(o,E)},Pe=o=>{var E=ht(),S=j(E),K=s(S);ee(K,5,()=>(T(pe),r(()=>Array(pe))),te,(n,v,p)=>{var g=vt();ee(g,5,()=>(T(ue),r(()=>Array(ue))),te,(I,M,P,m)=>{const _=N(()=>(e(t),r(()=>e(t).player.viewX+P))),b=N(()=>(e(t),r(()=>e(t).player.viewY+p))),h=N(()=>(T(e(_)),T(e(b)),r(()=>qe(e(_),e(b))))),H=N(()=>(T(e(_)),T(e(b)),r(()=>ye(e(_),e(b)))));var D=lt(),U=s(D);{var O=q=>{var w=nt(),f=j(w),C=i(f,2);{var Z=V=>{var c=it(),W=s(c);y(W,"src","./game_icons/player_icon.png"),a(c),k(V,c)};$(C,V=>{e(t),T(e(_)),T(e(b)),r(()=>e(t).player.x===e(_)&&e(t).player.y===e(b))&&V(Z)})}var G=i(C,2);ee(G,1,()=>e(H),te,(V,c)=>{var W=ot();A(()=>{y(W,"src",(e(c),r(()=>e(c)?.thumbnailImage?e(c).thumbnailImage:he+"/game_icons/entity_icon.png"))),y(W,"alt",(e(c),r(()=>e(c).name))),ae(W,1,`entity-icon ${e(c),r(()=>e(c).type)??""}`,"svelte-1qpiukk"),y(W,"title",(e(c),r(()=>e(c).name)))}),k(V,W)}),A(()=>{y(f,"src",(T(e(h)),r(()=>e(h).tileImage))),y(f,"alt",(T(e(h)),r(()=>e(h).tileType)))}),k(q,w)};$(U,q=>{e(h)&&q(O)})}a(D),A(()=>ae(D,1,`map-tile ${T(e(h)),r(()=>e(h)?.tileType)??""}`,"svelte-1qpiukk")),k(I,D)}),a(g),k(n,g)}),a(K);var Q=i(K,2);let de;var He=s(Q);{var Re=n=>{var v=pt(),p=j(v),g=s(p),I=i(g,2),M=s(I,!0);a(I),a(p);var P=i(p,2),m=s(P),_=s(m);y(_,"src","./game_icons/sword_rank.png");var b=i(_,2),h=s(b,!0);a(b),a(m);var H=i(m,2),D=s(H);y(D,"src","./game_icons/heart_rank.png");var U=i(D,2),O=s(U,!0);a(U),a(H),a(P);var q=i(P,2),w=s(q),f=s(w),C=s(f);y(C,"src","./game_icons/equipment.png"),a(f);var Z=i(f,2);{var G=z=>{var X=ct(),ce=s(X,!0);a(X),A(()=>R(ce,e(ne))),k(z,X)};$(Z,z=>{e(ie)&&z(G)})}a(w);var V=i(w,2),c=s(V),W=s(c);y(W,"src","./game_icons/magnifying_glass.png"),a(c);var ze=i(c,2);{var Xe=z=>{var X=ut(),ce=s(X,!0);a(X),A(()=>R(ce,(e(t),r(()=>e(t).currentEncounter.description)))),k(z,X)};$(ze,z=>{e(oe)&&z(Xe)})}a(V);var Be=i(V,2);a(q),A(()=>{y(g,"src",(e(t),r(()=>e(t).currentEncounter.profileImage))),y(g,"alt",(e(t),r(()=>e(t).currentEncounter.name))),R(M,(e(t),r(()=>e(t).currentEncounter.name))),R(h,(e(t),r(()=>e(t).currentEncounter.swordRank))),R(O,(e(t),r(()=>e(t).currentEncounter.heartRank)))}),u("mouseenter",f,()=>xe(e(t).currentEncounter)),u("mouseleave",f,Ie),u("mouseenter",c,Ae),u("mouseleave",c,Ee),u("click",Be,()=>x(se,!1)),k(n,v)};$(He,n=>{e(t),r(()=>e(t).currentEncounter)&&n(Re)})}a(Q);var ve=i(Q,2),Y=s(ve);ee(Y,5,()=>(e(t),r(()=>e(t).currentMessage)),te,(n,v)=>{var p=kt(),g=s(p,!0);a(p),A(I=>{ae(p,1,`message ${I??""}`,"svelte-1qpiukk"),R(g,e(v))},[()=>(e(v),r(()=>De(e(v))))]),k(n,p)}),a(Y),_e(Y,n=>x(B,n),()=>e(B));var me=i(Y,2),Se=s(me);y(Se,"src","./general/shrooms.png"),a(me),a(ve);var Ve=i(ve,2);{var We=n=>{var v=dt(),p=s(v),g=s(p),I=i(g,2),M=i(I,2),P=i(M,2),m=i(P,2);a(p);var _=i(p,2),b=s(_),h=i(b,2),H=i(h,2),D=i(H,2);a(_),a(v),u("click",g,()=>l.movePlayer(0,-1)),u("click",I,()=>x(le,!1)),u("click",M,()=>l.movePlayer(-1,0)),u("click",P,()=>l.movePlayer(0,1)),u("click",m,()=>l.movePlayer(1,0)),u("click",b,()=>l.handleAction("Z")),u("click",h,()=>l.handleAction("X")),u("click",H,()=>l.handleAction("C")),u("click",D,()=>l.handleAction("V")),k(n,v)},Ce=n=>{var v=mt();u("click",v,()=>x(le,!0)),k(n,v)};$(Ve,n=>{e(le)?n(We):n(Ce,!1)})}a(S);var Fe=i(S,2);{var Me=n=>{var v=ft(),p=s(v),g=s(p),I=i(g,2),M=i(I,2);{var P=m=>{var _=gt(),b=s(_),h=s(b,!0);a(b);var H=i(b,2);{var D=q=>{var w=_t(),f=j(w),C=s(f);a(f);var Z=i(f,2),G=s(Z);a(Z),A(()=>{R(C,`HP: ${e(t),r(()=>e(t).fullscreenImageDetails.hp)??""}`),R(G,`Attack: ${e(t),r(()=>e(t).fullscreenImageDetails.attack)??""}`)}),k(q,w)};$(H,q=>{e(t),r(()=>e(t).fullscreenImageDetails.type==="enemy")&&q(D)})}var U=i(H,2);{var O=q=>{var w=bt(),f=s(w);a(w),A(C=>R(f,`Dialogue: ${C??""}`),[()=>(e(t),r(()=>e(t).fullscreenImageDetails.dialogues[~~(Math.random()*e(t).fullscreenImageDetails.dialogues.length)]))]),k(q,w)};$(U,q=>{e(t),r(()=>e(t).fullscreenImageDetails.type==="npc")&&q(O)})}a(_),A(()=>R(h,(e(t),r(()=>e(t).fullscreenImageDetails.name)))),k(m,_)};$(M,m=>{e(t),r(()=>e(t).fullscreenImageDetails)&&m(P)})}a(p),a(v),A(()=>y(I,"src",(e(t),r(()=>e(t).fullscreenImageUrl)))),u("click",g,function(...m){l.closeFullscreenImage?.apply(this,m)}),u("click",p,Ne(function(m){et.call(this,ke,m)})),u("click",v,function(...m){l.closeFullscreenImage?.apply(this,m)}),k(n,v)};$(Fe,n=>{e(t),r(()=>e(t).showFullscreenImage)&&n(Me)})}A(n=>{je(K,`--viewport-width: ${ue}; --viewport-height: ${pe}; --tile-size: 32px;`),de=ae(Q,1,"encounter-box svelte-1qpiukk",null,de,n)},[()=>({hidden:!e(t).currentEncounter||!e(se)})]),k(o,E)};$(Te,o=>{re(),r(()=>!re().isInitialized)?o($e):o(Pe,!1)})}a(L),_e(L,o=>x(J,o),()=>e(J)),u("keydown",L,we),k(be,L),Ke(),fe()}export{Vt as component};
