import"../chunks/DsnmJJEf.js";import"../chunks/BICuxwOm.js";import{a as Ie,o as $e}from"../chunks/dkP-lNZr.js";import{ap as Pe,C as F,k as x,aC as Te,aD as Ce,aq as p,aE as Ve,az as v,ar as d,as as Fe,d as e,aF as We,aG as De,au as m,u as r,av as l,aw as se,T as f,f as X,ax as P,at as i,ay as ze}from"../chunks/eVu4eyQM.js";import{i as T}from"../chunks/CbkWCvrX.js";import{e as G,i as R}from"../chunks/Unz2ohpb.js";import{s as A}from"../chunks/C1T0uLfW.js";import{s as J}from"../chunks/OT850oBl.js";import{s as He}from"../chunks/CW4uCI9b.js";import{b as re}from"../chunks/D63EYBSs.js";import{s as Me}from"../chunks/BqlTOgs2.js";import{i as Se}from"../chunks/BQk6HzGS.js";import{b as Xe}from"../chunks/DMhMeZ7T.js";import{s as Ge,a as Re}from"../chunks/DDy39nHp.js";import{g as s,V as K,a as Y}from"../chunks/BOSI5car.js";import{E as Ue}from"../chunks/DsJ6x3sR.js";var Ze=p("<p>Loading map...</p>"),Le=p('<div class="player-icon svelte-1sr25qs"><img alt="Player" class="player-image svelte-1sr25qs"/></div>'),Oe=p("<img/>"),Be=p('<img class="tile-image svelte-1sr25qs"/> <!> <!>',1),Je=p("<div><!></div>"),Ke=p('<div class="map-row svelte-1sr25qs"></div>'),Ye=p("<p> </p>"),je=p('<div class="buttons-tray svelte-1sr25qs"><div class="dpad-container svelte-1sr25qs"><button class="dpad-button up svelte-1sr25qs">&#9650;</button> <button class="dpad-button hide-controls-button svelte-1sr25qs">&#10005;</button> <button class="dpad-button left svelte-1sr25qs">&#9664;</button> <button class="dpad-button down svelte-1sr25qs">&#9660;</button> <button class="dpad-button right svelte-1sr25qs">&#9654;</button></div> <div class="action-buttons svelte-1sr25qs"><button class="button-2 action-button svelte-1sr25qs">Z</button> <button class="button-2 action-button svelte-1sr25qs">X</button> <button class="button-2 action-button svelte-1sr25qs">C</button> <button class="button-2 action-button svelte-1sr25qs">V</button></div></div>'),Ne=p('<button class="floating-restore-button svelte-1sr25qs">Show Controls</button>'),Qe=p('<div class="fullscreen-overlay"><div class="fullscreen-image-container"><button class="close-button">&times;</button> <img alt="Fullscreen" class="fullscreen-image"/></div></div>'),et=p('<div class="game-container svelte-1sr25qs"><div class="map-screen svelte-1sr25qs"></div> <!> <div class="second-row svelte-1sr25qs"><div class="text-box svelte-1sr25qs"></div> <div class="small-encounter-screen svelte-1sr25qs"><img alt="" class="svelte-1sr25qs"/></div></div> <!></div> <!>',1),tt=p('<main tabindex="0" class="svelte-1sr25qs"><!></main>');function gt(oe,j){Pe(j,!1);const[ne,ie]=Re(),U=()=>Ge(s,"$gameStore",ne),le=".";let t=F(U()),W=F(),I=F();s.subscribe(a=>{x(t,a)}),Ie(()=>{e(I)&&De(I,e(I).scrollTop=e(I).scrollHeight)});function ce(a,b){return e(t).map.find(h=>h.x===a&&h.y===b)}function ve(a,b){return e(t).entities.filter(h=>h.x===a&&h.y===b)}function ue(a){if(e(t).showFullscreenImage&&a.key==="Escape"){s.closeFullscreenImage();return}switch(a.key){case"ArrowUp":case"w":s.movePlayer(0,-1);break;case"ArrowDown":case"s":s.movePlayer(0,1);break;case"ArrowLeft":case"a":s.movePlayer(-1,0);break;case"ArrowRight":case"d":s.movePlayer(1,0);break;case"z":s.handleAction("Z");break;case"x":s.handleAction("X");break;case"c":s.handleAction("C");break;case"v":s.handleAction("V");break}}$e(()=>{e(W)&&e(W).focus()});let Z=F(!0),D=F(!0);function de(a){return a.startsWith("[World]:")?"world":e(t).entities.some(b=>a.startsWith(`[${b.name}]:`)&&b.type==="npc")?"npc":a.includes("defeated")?"enemy":"player"}Te(()=>e(t),()=>{e(t).currentEncounter&&x(D,!0)}),Ce(),Se();var C=tt();Ve(a=>{We.title="Dawn's Journey : Map"});var me=m(C);{var pe=a=>{var b=Ze();d(a,b)},be=a=>{var b=et(),h=se(b),z=m(h);G(z,5,()=>(f(Y),r(()=>Array(Y))),R,(o,n,c)=>{var _=Ke();G(_,5,()=>(f(K),r(()=>Array(K))),R,(w,y,M,ee)=>{const q=X(()=>(e(t),r(()=>e(t).player.viewX+M))),k=X(()=>(e(t),r(()=>e(t).player.viewY+c))),g=X(()=>(f(e(q)),f(e(k)),r(()=>ce(e(q),e(k))))),S=X(()=>(f(e(q)),f(e(k)),r(()=>ve(e(q),e(k)))));var $=Je(),we=m($);{var Ae=O=>{var te=Be(),B=se(te),ae=i(B,2);{var Ee=V=>{var u=Le(),E=m(u);A(E,"src","./game_icons/player_icon.png"),l(u),d(V,u)};T(ae,V=>{e(t),f(e(q)),f(e(k)),r(()=>e(t).player.x===e(q)&&e(t).player.y===e(k))&&V(Ee)})}var xe=i(ae,2);G(xe,1,()=>e(S),R,(V,u)=>{var E=Oe();P(()=>{A(E,"src",(e(u),r(()=>e(u)?.thumbnailImage?e(u).thumbnailImage:le+"/game_icons/entity_icon.png"))),A(E,"alt",(e(u),r(()=>e(u).name))),J(E,1,`entity-icon ${e(u),r(()=>e(u).type)??""}`,"svelte-1sr25qs"),A(E,"title",(e(u),r(()=>e(u).name)))}),d(V,E)}),P(()=>{A(B,"src",(f(e(g)),r(()=>e(g).tileImage))),A(B,"alt",(f(e(g)),r(()=>e(g).tileType)))}),d(O,te)};T(we,O=>{e(g)&&O(Ae)})}l($),P(()=>J($,1,`map-tile ${f(e(g)),r(()=>e(g)?.tileType)??""}`,"svelte-1sr25qs")),d(w,$)}),l(_),d(o,_)}),l(z);var N=i(z,2);{var _e=o=>{Ue(o,{get encounter(){return e(t),r(()=>e(t).currentEncounter)},$$events:{hideEncounterCard:()=>x(D,!1),give:()=>s.handleAction("GIVE")}})};T(N,o=>{e(t),e(D),r(()=>e(t).currentEncounter&&e(t).currentEncounter.type!=="enemy"&&e(D))&&o(_e)})}var L=i(N,2),H=m(L);G(H,5,()=>(e(t),r(()=>e(t).currentMessage)),R,(o,n)=>{var c=Ye(),_=m(c,!0);l(c),P(w=>{J(c,1,`message ${w??""}`,"svelte-1sr25qs"),ze(_,e(n))},[()=>(e(n),r(()=>de(e(n))))]),d(o,c)}),l(H),re(H,o=>x(I,o),()=>e(I));var Q=i(H,2),fe=m(Q);A(fe,"src","./general/shrooms.png"),l(Q),l(L);var ge=i(L,2);{var he=o=>{var n=je(),c=m(n),_=m(c),w=i(_,2),y=i(w,2),M=i(y,2),ee=i(M,2);l(c);var q=i(c,2),k=m(q),g=i(k,2),S=i(g,2),$=i(S,2);l(q),l(n),v("click",_,()=>s.movePlayer(0,-1)),v("click",w,()=>x(Z,!1)),v("click",y,()=>s.movePlayer(-1,0)),v("click",M,()=>s.movePlayer(0,1)),v("click",ee,()=>s.movePlayer(1,0)),v("click",k,()=>s.handleAction("Z")),v("click",g,()=>s.handleAction("X")),v("click",S,()=>s.handleAction("C")),v("click",$,()=>s.handleAction("V")),d(o,n)},ye=o=>{var n=Ne();v("click",n,()=>x(Z,!0)),d(o,n)};T(ge,o=>{e(Z)?o(he):o(ye,!1)})}l(h);var qe=i(h,2);{var ke=o=>{var n=Qe(),c=m(n),_=m(c),w=i(_,2);l(c),l(n),P(()=>A(w,"src",(e(t),r(()=>e(t).fullscreenImageUrl)))),v("click",_,function(...y){s.closeFullscreenImage?.apply(this,y)}),v("click",c,Me(function(y){Xe.call(this,j,y)})),v("click",n,function(...y){s.closeFullscreenImage?.apply(this,y)}),d(o,n)};T(qe,o=>{e(t),r(()=>e(t).showFullscreenImage)&&o(ke)})}P(()=>He(z,`--viewport-width: ${K}; --viewport-height: ${Y}; --tile-size: 32px;`)),d(a,b)};T(me,a=>{U(),r(()=>!U().isInitialized)?a(pe):a(be,!1)})}l(C),re(C,a=>x(W,a),()=>e(W)),v("keydown",C,ue),d(oe,C),Fe(),ie()}export{gt as component};
